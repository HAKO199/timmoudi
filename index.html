<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تيمودي - مشروع مدموج</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1220; --bg-2:#0f1a2b; --card:#0f1724; --muted:#9aa7bf;
  --accent:#7c5cff; --accent-2:#00d4ff; --glass: rgba(255,255,255,0.03);
  --text:#e9eef8;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Tajawal',system-ui,Segoe UI,Roboto,Arial;background:
  radial-gradient(900px 400px at 10% -10%, #16213b 0%, transparent 40%), linear-gradient(180deg,var(--bg),var(--bg-2));
  color:var(--text); -webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:18px}

/* topbar */
.topbar{position:sticky;top:0;z-index:90;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03)}
.inner{display:flex;align-items:center;gap:12px;padding:12px 18px}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:48px;height:48px;border-radius:10px;background:conic-gradient(from 120deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:900;color:#031025}
.site-title{font-weight:800;font-size:1.05rem}
.socials{display:flex;gap:8px;margin-inline-start:12px}
.icon{width:36px;height:36;border-radius:8px;display:grid;place-items:center;background:var(--glass);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
.controls{margin-inline-start:auto;display:flex;align-items:center;gap:8px}

/* small buttons */
.btn{padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#071024;font-weight:700;cursor:pointer}
.small-btn{padding:6px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted)}
.theme-toggle{font-size:18px;cursor:pointer}

/* frames */
.frame{margin-top:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.frame h3{margin:0 0 12px}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.card{background:var(--card);border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .15s,box-shadow .15s}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(2,6,23,0.6)}
.card img{width:100%;height:140px;object-fit:cover;display:block}
.card .meta{padding:10px;font-size:14px;color:var(--muted)}

/* videos */
.vgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.vcard{display:flex;gap:10px;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
.vthumb{width:110px;height:70px;flex-shrink:0;border-radius:8px;overflow:hidden}
.vthumb img{width:100%;height:100%;object-fit:cover}

/* audios */
.audios{display:flex;flex-direction:column;gap:10px}
.audio-item{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);display:flex;align-items:center;gap:10px}

/* store/games */
.store-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}

/* news */
.news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.news-card{background:var(--card);border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);padding:12px;display:flex;flex-direction:column}
.news-card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
.news-card .title{font-weight:800;margin-top:8px}
.news-card .excerpt{color:var(--muted);font-size:14px;max-height:72px;overflow:hidden;transition:max-height .3s ease}
.news-card.expanded .excerpt{max-height:none}

/* comments */
.comments{margin-top:10px}
.comment-list{max-height:160px;overflow:auto;padding-right:6px}
.comment{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin-bottom:8px}
.comment strong{color:var(--accent)}
.comment time{display:block;font-size:12px;color:var(--muted)}

/* lightbox & modals */
.lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);z-index:200}
.lightbox.open{display:flex}
.lightbox img{max-width:90vw;max-height:85vh;border-radius:8px}
.vmodal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);z-index:210}
.vmodal.open{display:flex}
.vmodal-box{background:var(--card);padding:12px;border-radius:10px;max-width:900px;width:95%}
.vmodal iframe{width:100%;height:500px;border:0;border-radius:8px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:220}
.modal.open{display:flex}
.modal-box{background:linear-gradient(180deg,var(--card), rgba(255,255,255,0.01));padding:18px;border-radius:12px;width:420px;max-width:94%;border:1px solid rgba(255,255,255,0.03)}
.form-row{display:flex;align-items:center;gap:8px;margin:8px 0}
.label{min-width:120px;color:var(--muted)}

/* responsive */
@media (max-width:900px){ .vthumb{width:90px;height:60px} .card img{height:120px} .vmodal iframe{height:320px} }
@media (max-width:600px){ .inner{flex-wrap:wrap} .controls{margin-inline-start:0;width:100%;justify-content:space-between} .logo{width:44px;height:44px} .site-title{font-size:1rem} .vmodal iframe{height:260px} }

/* socials official colors */
.socials a{font-size:18px;width:34px;height:34px;display:grid;place-items:center;border-radius:50%;background:#fff}
.socials a.fb{color:#1877F2}.socials a.yt{color:#FF0000}.socials a.dc{color:#5865F2}.socials a.tt{color:#000}
.nav-links{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
.nav-links a{padding:6px 10px;border-radius:6px;background:rgba(255,255,255,0.1);color:#fff;font-size:14px}
.search-bar{text-align:center;margin:10px}
.search-bar input{padding:10px 14px;border-radius:8px;width:80%;max-width:600px;
  border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:var(--text)}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"></head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="inner container">
      <div class="logo">
      <img src= "https://yt3.ggpht.com/7dfnAeeOR4Olx-PVWzbY2_EE889DLhgqaNiBynzk13VeRIZMomGuUgzRQcQjjw_ElpLrFm_EyQKzlvw=s640-c-fcrop64=1,00000000ffffffff-rw-nd-v1" alt="Timodi Logo" style="width:48px;height:48px;border-radius:10px;object-fit:cover">
      <div>
        <div class="site-title">تيمودي</div>
        <div style="font-size:12px;color:var(--muted)">تيمودي</div>
      </div>
    </div>
    
    <div class="socials">
      <a href="https://facebook.com" target="_blank" class="fb"><i class="fab fa-facebook-f"></i></a>
      <a href="https://youtube.com" target="_blank" class="yt"><i class="fab fa-youtube"></i></a>
      <a href="https://discord.com" target="_blank" class="dc"><i class="fab fa-discord"></i></a>
      <a href="https://tiktok.com" target="_blank" class="tt"><i class="fab fa-tiktok"></i></a>
    </div>

    <div class="nav-links">
      <a href="#topGallery">📷 الصور</a>
      <a href="#videosFrame">🎥 الفيديوهات</a>
      <a href="#audioFrame">🎵 الصوتيات</a>
      <a href="#newsFrame">📰 المقالات</a>
      <a href="#liveFrame">📡 البث</a>
      <a href="#gamesFrame">🎮 الألعاب</a>
      <a href="#storeFrame">🛒 المتجر</a>
    </div>

    <div class="controls">
      <div id="themeToggle" class="theme-toggle" title="وضع الليل/النهار">🌙</div>
      <button id="settingsBtn" class="small-btn" title="الإعدادات">⚙️</button>
      <button id="profileBtn" class="small-btn" title="تسجيل/الملف">👤</button>
    </div>
  </div>

  <!-- search bar -->
  <div class="search-bar"><input type="text" id="search" placeholder="ابحث هنا..."></div>

  <!-- gallery strip -->
  <div class="container" style="padding-bottom:12px;padding-top:8px">
    <div class="frame">
      <h3>معرض صور سريع</h3>
      <div class="gallery" id="topGallery"></div>
    </div>
  </div>
</header>

<main class="container" style="padding-top:16px">
  <section class="frame" id="videosFrame">
    <h3>فيديوهات (YouTube / Facebook / TikTok)</h3>
    <div class="vgrid" id="videosGrid"></div>
  </section>

  <section class="frame" id="newsFrame">
    <h3>📰 المقالات الإخبارية</h3>
    <div class="news-grid" id="newsGrid"></div>
  </section>
</main>

  <section class="frame" id="audioFrame">
    <h3>الصوتيات</h3>
    <div class="audios" id="audiosList"></div>
  </section>

  <section class="frame" id="storeFrame">
    <h3>المتجر</h3>
    <div class="store-grid" id="storeGrid"></div>
  </section>

  <section class="frame" id="gamesFrame">
    <h3>الألعاب</h3>
    <div class="games-grid" id="gamesGrid"></div>
  </section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox"><img id="lightboxImg" alt="preview"/></div>

<!-- Video Modal -->
<div class="vmodal" id="videoModal"><div class="vmodal-box"><iframe id="videoFrame" allowfullscreen></iframe><div style="text-align:right;margin-top:8px"><button id="closeVideo" class="small-btn">إغلاق</button></div></div></div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal"><div class="modal-box"><h4>الإعدادات</h4>
  <div class="form-row"><div class="label">اللغة</div><select id="langSelect"><option value="ar">العربية</option><option value="en">English</option></select></div>
  <div class="form-row"><div class="label">حماية الصفحة</div><input type="checkbox" id="privacyToggle" /></div>
  <div class="form-row"><div class="label">عرض الوسائط</div><select id="layoutMode"><option value="grid">شبكة</option><option value="list">قائمة</option></select></div>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button id="saveSettings" class="btn">حفظ</button><button id="closeSettings" class="small-btn">إغلاق</button></div>
</div></div>

<!-- Profile / Login Modal -->
<div class="modal" id="profileModal"><div class="modal-box">
  <h4>الملف الشخصي / تسجيل</h4>
  <div class="form-row"><div class="label">الاسم</div><input id="pName" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)"></div>
  <div class="form-row"><div class="label">البريد</div><input id="pEmail" type="email" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)"></div>
  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button id="saveProfile" class="btn">حفظ</button><button id="closeProfile" class="small-btn">إغلاق</button></div>
</div></div>
</style></a>
<!-- Welcome Marquee -->

  <div class="container" style="padding:40px 20px">
    <div style="overflow:hidden;white-space:nowrap;">
      <h1 class="rainbow-marquee">
        مرحبا بك في <b>تيمودي</b>
      </h1>
    </div>
  </div>
  <style>
  .rainbow-marquee {
    display: inline-block;
    font-size: 2.2rem;
    font-weight: 900;
    padding: 0.2em 1.5em;
    background: linear-gradient(90deg, #ff005a, #ffae00, #00ffb2, #00c3ff, #7c5cff, #ff005a 60%);
    background-size: 200% auto;
    color: transparent;
    -webkit-background-clip: text;
    background-clip: text;
    animation: rainbow-move 3.5s linear infinite, marquee-move 12s linear infinite;
    white-space: nowrap;
  }
  @keyframes rainbow-move {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }
  @keyframes marquee-move {
    0% { transform: translateX(100%);}
    100% { transform: translateX(-100%);}
  }
  </style>


<script>
// helpers
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const escapeHtml = str => String(str).replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));

// demo data
const photos = [
  {id:'p1',title:'غروب في ملعب الجديد تيمودي',img:'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhoHVk_cXCt_sHsaTRz8pGbTwS0Tgd3p66_vRy_1OU3VCxhlCx3sO6udiWGumzSQaLeIi7oqqvg8QtzKQ5xMK0NURzLQ28DALUv1WFIf9EWjls9bp193n4S7mcVI2eeA1xSr_9gVh7yDzOZbm0CGi2lKm27w46EWpgh0Bef7ba3CMp6BGYNfG7pK93CNOQ/s320-rw/IMG_20250516_193502.jpg'},
  {id:'p2',title:'قصر الكبير تيمودي 🔥 ',img:'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgCHkG0hyQ3FsmYuqowmwcVB9B-LgwAYiLuw-eJcg6K-RbBRSwrPuE-QoEP9-DBvIsRJ54aBUtfR1YHZ-ITr7t1B1Kn2ugOnOBQ_MEndJLgcp8PewVnnXN8GS2y0i9mhKNtW_KgLch0_Ws/s320/FB_IMG_1433399393728.jpg'},
  {id:'p3',title:'تلاحم الغيوم فوق الرمال دهبية  ',img:'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgTVaREUkhmMa57VBzdmFX-1UeiXr1-0lkhkr54b5F3rWOgTGhxq4MJbKoGD2JUva_ZD21hAmLHBjZ1Mv6iYS2Vx0pHGxIFfoXzXlyGQTAxjjB6reDXfR4HF91Iq8h-68u1Mig2FyjDlak9C6wigOQkCegqlVZsQ174b__VzaPM7ViP9WHxphv_K2se7HE/s320-rw/20241016_123522.heic'},
  {id:'p4',title:'ملهى الأطفال  ',img:'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjp8pwdOst-zgEo_OGGidSqOYhS97Lp9DUHiOQnm5rlceNtlKMtcw6ZQOARc1e97eq7KHh6M44k8NCf2dOA1e3PEtIar1hi-_Edx9rtc13Zfto7BMBVYtdTiAFN2us4F0ntX4KdLrnC7qk/s320/FB_IMG_1433399429854.jpg'},
  {id:'p5',title:'المولد النبوي الشريف بني عباس 2025 ',img:'https://cdn.elitihadcom.dz/wp-content/uploads/2018/11/mawlid-bechar.jpg'},
  {id:'p6',title:'محمد الأمين كيحل ممثل ولاية بني عباس بالمجلس الأعلى للشباب تيمودي ',img:'https://scontent.forn1-2.fna.fbcdn.net/v/t39.30808-6/481958304_618352377607412_4440888128410987425_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFaoLHxZufO_KByLzx0IRrMdLMDIy4rrKt0swMjLiusq0xuPsfuOQSxgtSLsNNv0DxWs3xZLtmuD92geoA-ab-a&_nc_ohc=hlrSmkqs1TQQ7kNvwGLhNz4&_nc_oc=AdkChJn8lf5LWFQywV1YrwPPaj1Rt_6rkhfvRgkNywDSmLslAruZNbVrusx0kIpJvUw&_nc_zt=23&_nc_ht=scontent.forn1-2.fna&_nc_gid=2icK_iIGuq-RXzFAQtMqTw&oh=00_AfbtSX2IE2ZB0fGOhS8f5tEW_4VZIhEsdMO_bKtpYQpzrQ&oe=68C8D1AC'}
];
const videos = [
  {id:'v1',title:'مونتاج ببجي',thumb:'https://i.ytimg.com/vi/Md4_36hnAMo/hqdefault.jpg',embed:'https://www.youtube.com/embed/Md4_36hnAMo'},
  {id:'v1',title:'مدينة تيمودي ',thumb:'https://i9.ytimg.com/vi_webp/lxXCW5eFeOE/mq1.webp?sqp=CMiAnMYG-oaymwEmCMACELQB8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGGUgZShGMA8=&rs=AOn4CLCME5jvWWsqKLmg6U5zHSAZ_TWD7g',embed:'https://www.youtube.com/embed/lxXCW5eFeOE?start=70'},
  {id:'v1',title:'ارخس كيبورد ميكانيكي في الجزائر / HAVIT kb435L dz ',thumb:'https://i9.ytimg.com/vi_webp/eRBwEuzC4Kk/mqdefault.webp?v=66f602f3&sqp=CPSCnMYG&rs=AOn4CLCYOWQs4ISm5X2KcS9CpuAzVKY1Yw',embed:'https://www.youtube.com/embed/eRBwEuzC4Kk'},
  {id:'v1',title:'كال اوف دوتي وارزون موسم 3',thumb:'https://i9.ytimg.com/vi_webp/Hs8cfoTaDl4/mq2.webp?sqp=CMyHnMYG-oaymwEmCMACELQB8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGGUgXChJMA8=&rs=AOn4CLD_lXasckapUzoLK4rw-X3JEwJe3A',embed:'https://www.youtube.com/embed/Hs8cfoTaDl4'},
  {id:'v1',title:'محمد الأمين كيحل: ممثل ولاية بني عباس بالمجلس الأعلى للشباب',thumb:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKl_Bt-OQTE5-pdpK82mQxxWhIzFxzgIY-2_m2wkMpGfV0-HI7t_7t4XJhEtAITDeinj8&usqp=CAU',embed:'https://www.youtube.com/embed/IGSuGA0MeXI'},
  {id:'v2',title:'تيك توك مثال',thumb:'https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Sunflower_from_Silesia2.jpg/1200px-Sunflower_from_Silesia2.jpg',embed:'https://www.tiktok.com/embed//7490353107705007365?is_from_webapp=1'},
  {id:'v3',title:'فيديو فيسبوك',thumb:'https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Sunflower_from_Silesia2.jpg/1200px-Sunflower_from_Silesia2.jpg',embed:'https://www.facebook.com/HakoOnlin/videos/4953952824698468'}
];
const news = [
  {id:'n1',title:'حدث هام اليوم',img:'https://i.dzs.cloud/www.echoroukonline.com/wp-content/uploads/2021/03/n-15.jpg?resize=790,444.375',excerpt:'.🏅 بلدية تيمودي تستقبل أوّل وزير منذ عام 1962! .',full:'أبدى الوزير الجديد للشباب والرياضة سيد علي خالدي فخره، بِكونه أوّل مسؤول حكومي يزور بلدية تيمودي التي تقع في الجنوب الشرقي لِولاية بشار، منذ استعادة بلادنا سيادتها واستقلالها من المُستعمِر الفرنسي البغيض عام 1962. وكان وزير الشباب والرياضة سيد علي خالدي قد انتقل إلى ولاية بشار، في زيارة عمل وتفقّد، الإثنين الماضي. وقال سيد علي خالدي إنه أنصت إلى انشغالات الشباب بِبلدية تيمودي، وولاية بشار عموما. ودشّن عددا من المرافق الرياضية والإجتماعية بِعاصمة الجنوب الغربي للوطن. " المزيد'}
];
const audios = [
  {id:'a1',title:'موسيقى خلفية',src:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'}
];
const store = [
  {id:'s1',title:'تيشيرت تيمودي',img:'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200&auto=format&fit=crop',price:'00ج'},
];
const games = [
  {id:'g1',title:'PUBG',img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTyOmU7UkYUBKS3vcrWq-A9k8UeBRD9CmYXwplLMtCaaY75Ty12mahaCF6FKunfit3aUHQ&usqp=CAU'}
];

// storage
let settings = JSON.parse(localStorage.getItem('site_settings')||'{"theme":"dark","lang":"ar","privacy":false,"layout":"grid"}');
let user = JSON.parse(localStorage.getItem('site_user')||'null');
let commentsDB = JSON.parse(localStorage.getItem('site_comments')||'{}');

// apply settings
function applySettings(){
  $('#themeToggle').textContent = settings.theme==='dark' ? '🌙' : '☀️';
  if(settings.layout==='list'){
    $$('.gallery, .vgrid, .store-grid, .games-grid, .news-grid').forEach(el=>el.style.gridTemplateColumns='1fr');
  } else {
    $$('.gallery').forEach(el=>el.style.gridTemplateColumns='repeat(auto-fill,minmax(200px,1fr))');
    $$('.vgrid').forEach(el=>el.style.gridTemplateColumns='repeat(auto-fill,minmax(220px,1fr))');
    $$('.store-grid').forEach(el=>el.style.gridTemplateColumns='repeat(auto-fill,minmax(160px,1fr))');
    $$('.games-grid').forEach(el=>el.style.gridTemplateColumns='repeat(auto-fill,minmax(200px,1fr))');
    $$('.news-grid').forEach(el=>el.style.gridTemplateColumns='repeat(auto-fill,minmax(280px,1fr))');
  }
  if(settings.privacy){
    document.querySelectorAll('main, .frame, .gallery').forEach(el=> el.style.filter='blur(6px)');
  } else {
    document.querySelectorAll('main, .frame, .gallery').forEach(el=> el.style.filter='none');
  }
  localStorage.setItem('site_settings', JSON.stringify(settings));
}

// renderers
function renderTopGallery(){
  const g = $('#topGallery'); g.innerHTML='';
  photos.forEach(p=>{
    const c = document.createElement('div'); c.className='card'; c.dataset.id=p.id;
    c.innerHTML = `<img src="${p.img}" alt="${escapeHtml(p.title)}"><div class="meta"><strong>${escapeHtml(p.title)}</strong></div>`;
    c.addEventListener('click', ()=> openLightbox(p.img));
    g.appendChild(c);
  });
}

function renderVideos(){
  const g = $('#videosGrid'); g.innerHTML='';
  videos.forEach(v=>{
    const el = document.createElement('div'); el.className='vcard';
    el.innerHTML = `<div class="vthumb"><img src="${v.thumb}" alt="${escapeHtml(v.title)}"></div><div style="flex:1"><div style="font-weight:700">${escapeHtml(v.title)}</div><div style="color:var(--muted);font-size:13px">${v.embed.includes('youtube')?'YouTube':v.embed.includes('tiktok')?'TikTok':'Other'}</div></div>`;
    el.addEventListener('click', ()=> openVideoModal(v.embed));
    g.appendChild(el);
  });
}

function renderAudios(){
  const g = $('#audiosList'); g.innerHTML='';
  audios.forEach(a=>{
    const d = document.createElement('div'); d.className='audio-item';
    d.innerHTML = `<div style="flex:1;font-weight:700">${escapeHtml(a.title)}</div><audio controls src="${a.src}"></audio>`;
    g.appendChild(d);
  });
}

function renderStore(){
  const g = $('#storeGrid'); g.innerHTML='';
  store.forEach(s=>{
    const d = document.createElement('div'); d.className='store-item';
    d.innerHTML = `<img src="${s.img}" style="width:100%;height:120px;object-fit:cover;border-radius:8px"><div style="font-weight:700;margin-top:8px">${escapeHtml(s.title)}</div><div style="color:var(--muted);margin:8px 0">${escapeHtml(s.price)}</div>`;
    // comments container
    const comments = document.createElement('div'); comments.className='comments'; comments.id='c-'+s.id;
    comments.innerHTML = `<div class="comment-list"></div>`;
    d.appendChild(comments);
    g.appendChild(d);
    renderComments(s.id);
  });
}

function renderGames(){
  const g = $('#gamesGrid'); g.innerHTML='';
  games.forEach(item=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<img src="${item.img}" style="height:140px;object-fit:cover"><div class="meta" style="padding:10px;font-weight:700">${escapeHtml(item.title)}</div>`;
    const comments = document.createElement('div'); comments.className='comments'; comments.id='c-'+item.id;
    comments.innerHTML = `<div class="comment-list"></div>`;
    d.appendChild(comments);
    g.appendChild(d);
    renderComments(item.id);
  });
}

function renderNews(){
  const g = $('#newsGrid'); g.innerHTML='';
  news.forEach(n=>{
    const d = document.createElement('div'); d.className='news-card'; d.dataset.id=n.id;
    d.innerHTML = `<img src="${n.img}" alt="${escapeHtml(n.title)}"><div class="title">${escapeHtml(n.title)}</div><div class="excerpt">${escapeHtml(n.excerpt)}</div>`;
    const btn = document.createElement('button'); btn.className='small-btn'; btn.textContent='اقرأ المزيد';
    btn.addEventListener('click', ()=>{
      if(!d.classList.contains('expanded')){
        d.querySelector('.excerpt').textContent = n.full;
        d.classList.add('expanded');
        btn.textContent='إخفاء';
      } else {
        d.querySelector('.excerpt').textContent = n.excerpt;
        d.classList.remove('expanded');
        btn.textContent='اقرأ المزيد';
      }
    });
    d.appendChild(btn);
    // comments area
    const comments = document.createElement('div'); comments.className='comments'; comments.id='c-'+n.id;
    comments.innerHTML = `<div class="comment-list"></div>`;
    // comment form
    const form = document.createElement('div'); form.className='comment-form'; form.style.display='flex'; form.style.gap='8px'; form.style.marginTop='8px';
    const input = document.createElement('input'); input.placeholder='أضف تعليقاً...'; input.id='t-'+n.id; input.style.flex='1'; input.style.padding='8px'; input.style.borderRadius='8px'; input.style.background='rgba(255,255,255,0.02)'; input.style.border='1px solid rgba(255,255,255,0.03)';
    const send = document.createElement('button'); send.className='btn'; send.textContent='إرسال'; send.type='button';
    send.addEventListener('click', ()=> addComment(n.id));
    form.appendChild(input); form.appendChild(send);
    comments.appendChild(form);
    d.appendChild(comments);
    g.appendChild(d);
    renderComments(n.id);
  });
}

// comments
function renderComments(key){
  const box = document.getElementById('c-'+key);
  if(!box) return;
  const list = box.querySelector('.comment-list');
  if(!list) return;
  list.innerHTML = '';
  const items = commentsDB[key] || [];
  // show first 3 by default, add toggle if more
  const toShow = items.length>3 ? items.slice(0,3) : items;
  toShow.forEach(c=>{
    const el = document.createElement('div'); el.className='comment';
    el.innerHTML = `<strong>${escapeHtml(c.user)}</strong><div>${escapeHtml(c.text)}</div><time>${c.time}</time>`;
    list.appendChild(el);
  });
  // toggle button
  let toggle = box.querySelector('.toggle-comments');
  if(items.length>3){
    if(!toggle){
      toggle = document.createElement('button'); toggle.className='small-btn toggle-comments'; toggle.style.marginTop='6px';
      toggle.addEventListener('click', ()=>{
        if(toggle.dataset.open==='1'){
          // collapse
          renderComments(key);
        } else {
          // expand
          list.innerHTML = '';
          items.forEach(c=>{
            const el = document.createElement('div'); el.className='comment';
            el.innerHTML = `<strong>${escapeHtml(c.user)}</strong><div>${escapeHtml(c.text)}</div><time>${c.time}</time>`;
            list.appendChild(el);
          });
          toggle.textContent='إخفاء التعليقات';
          toggle.dataset.open='1';
        }
      });
      box.appendChild(toggle);
    }
    toggle.textContent = 'عرض المزيد من التعليقات';
    toggle.dataset.open='0';
  } else {
    if(toggle) toggle.remove();
  }
}

function addComment(key){
  if(!user){ alert('سجّل الدخول أولاً'); openProfileModal(); return; }
  const input = document.getElementById('t-'+key);
  if(!input) return;
  const text = input.value.trim();
  if(!text) return alert('اكتب تعليقاً');
  const newC = {user:user.name, text, time:new Date().toLocaleString()};
  commentsDB[key] = commentsDB[key]||[];
  commentsDB[key].push(newC);
  localStorage.setItem('site_comments', JSON.stringify(commentsDB));
  input.value='';
  renderComments(key);
}

// lightbox & video modal
function openLightbox(src){ $('#lightboxImg').src = src; $('#lightbox').classList.add('open'); }
$('#lightbox').addEventListener('click', ()=> $('#lightbox').classList.remove('open'));

function openVideoModal(src){
  $('#videoFrame').src = src + (src.includes('?') ? '&autoplay=1' : '?autoplay=1');
  $('#videoModal').classList.add('open');
}
$('#closeVideo').addEventListener('click', ()=> { $('#videoModal').classList.remove('open'); $('#videoFrame').src=''; });

// settings & profile
$('#settingsBtn').addEventListener('click', ()=> { $('#settingsModal').classList.add('open'); $('#langSelect').value = settings.lang; $('#privacyToggle').checked = settings.privacy; $('#layoutMode').value = settings.layout; });
$('#closeSettings').addEventListener('click', ()=> $('#settingsModal').classList.remove('open'));
$('#saveSettings').addEventListener('click', ()=> { settings.lang = $('#langSelect').value; settings.privacy = $('#privacyToggle').checked; settings.layout = $('#layoutMode').value; applySettings(); $('#settingsModal').classList.remove('open'); });

function openProfileModal(){ $('#profileModal').classList.add('open'); if(user){ $('#pName').value = user.name; $('#pEmail').value = user.email; } }
$('#profileBtn').addEventListener('click', openProfileModal);
$('#closeProfile').addEventListener('click', ()=> $('#profileModal').classList.remove('open'));
$('#saveProfile').addEventListener('click', ()=> { const name = $('#pName').value.trim(); const email = $('#pEmail').value.trim(); if(!name||!email) return alert('املأ الحقول'); user = {name,email}; localStorage.setItem('site_user', JSON.stringify(user)); alert('تم الحفظ'); $('#profileModal').classList.remove('open'); renderAll(); });

// theme toggle
$('#themeToggle').addEventListener('click', ()=> {
  settings.theme = settings.theme==='dark' ? 'light' : 'dark';
  if(settings.theme==='light'){
    document.documentElement.style.setProperty('--bg','#f4f7fb'); document.documentElement.style.setProperty('--bg-2','#ffffff');
    document.documentElement.style.setProperty('--card','#ffffff'); document.documentElement.style.setProperty('--text','#0b1220'); document.documentElement.style.setProperty('--muted','#556171');
  } else {
    document.documentElement.style.setProperty('--bg','#0b1220'); document.documentElement.style.setProperty('--bg-2','#0f1a2b');
    document.documentElement.style.setProperty('--card','#0f1724'); document.documentElement.style.setProperty('--text','#e9eef8'); document.documentElement.style.setProperty('--muted','#9aa7bf');
  }
  localStorage.setItem('site_settings', JSON.stringify(settings));
  applySettings();
});

// initialization
function renderAll(){
  renderTopGallery(); renderVideos(); renderAudios(); renderStore(); renderGames(); renderNews();
}
applySettings();
renderAll();
// البحث العام
document.getElementById('search').addEventListener('input',function(){
  const q=this.value.toLowerCase();
  document.querySelectorAll('main section').forEach(sec=>{
    if(sec.textContent.toLowerCase().includes(q)){
      sec.style.display='block';
    } else {
      sec.style.display='none';
    }
  });
});
</script>
</body>
</html>